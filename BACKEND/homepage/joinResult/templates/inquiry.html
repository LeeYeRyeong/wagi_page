{% load static %}
<!DOCTYPE html>
<html>
<head>
  <title>합격자 조회, 지원서 제출</title>
   <style>
   .modal_unavailable{
      display:none;
  }
   .modal_pass{
      display:none;
   }
   .modal_fail{
      display:none;
   }
  </style>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
 </head>
 <body>
    <!--상단 네비바-->
    <header id="main-header">
        <img alt="WAGI logo image">
        <nav id="main-navigation">
            <ul class="menu">
                <li class="menu-item">Activities</li> 
                <li class="menu-item">People</li>
                <li class="menu-item" id="apply"><a href={% url 'joinResult:join_button' %}>JOIN</a></li>
                <li class="menu-item">Notice</li>
            </ul> 
        </nav> 
    </header>
    <!-- 합격자 조회 버튼-->
   <form method='post' action={% url 'joinResult:result' %}>
      {% csrf_token %}
      {% if isDate == 2 %}
      <input id="input_studentNum" type="text" name="inputId" placeholder="학번을 입력하세요.">
      <a href={% url 'joinResult:result' %}>
         <button id="btn_studentNum">합격자 조회</button>
      </a>
      {%endif%}
      {% if isDate == 0 or isDate == 1 %}
      <input type="text" name="inputId" placeholder="학번을 입력하세요.", disabled>
      <a href={% url 'joinResult:result' %}>
         <button disabled>합격자 조회</button>
      </a>
      {%endif%}
      </form>
      
    <!--지원서 제출 버튼-->
   <form method='post' action={% url 'joinResult:write_form' %}>
      {% csrf_token %}
      {% if isDate == 1 %}
      <a href={% url 'joinResult:write_form' %}>
         <button>지원서 제출</button>
      </a>
      {%endif%}
      {% if isDate == 0 or isDate == 2 %}
      <a href={% url 'joinResult:write_form' %}>
       <button disabled>지원서 제출</button>
      </a>
      {%endif%}
   </form>
    
    <!--메일 입력창-->
      <div class="modal_unavailable">
         <div class="modal-box1">
             <img class="imgWagi">
             <button id="close-modal" style="padding-bottom: 3px;">✕</button>
             <p>
                 <br>
                 <br>
             </p>
             <div class="modal-content1">
                 <h2 class="message">지금은 모집 기간이 아니에요!</h2>
                 <h4 class="message">아래의 메일을 입력해주시면<br>모집 기간에 안내 메일을 발송해드립니다.</h4>
                 <form id="email" method="post" action={% url 'joinResult:join_button' %}>
                   {% csrf_token %}
                   {{input_mail.as_p}}
                   <input id="input_email" type="email" name="user_mail" placeholder="메일을 입력해주세요." required="required">
                 </form>
             </div>
             <p class="up">
             </p>
         </div>
     </div>
  <!--합격자 발표창_합격-->
   <div class="modal_pass">
      <div class="modal-box2">
          <img class="imgWagi" >
          <div class="modal-content2">
              <h2 class="message"><p id="p_stdId" style="display:inline;"></p>&nbsp;<p id="p_stdName" style="display:inline;"></p>님!</h2>
              <h4 class="message">WAGI 신입부원 모집에<br>최종합격 하신 것을 진심으로 축하드립니다!</h4>
              <div class="OT_info">
                  <div class="OT_message">
                      <h4 style="margin-top: 14px;">OT일정을 안내드립니다.</h4>
                      <h4>
                          일시: 2024년 3월 7일 목요일 6시
                          <br>
                          장소: 성신관 301호
                      </h4>
                      <h5>*노트북 없이 와도 됩니다!</h5>
                  </div>
              </div>
          </div>
      </div>
  </div>
  <!--불합격자 발표창_합격-->
  <div class="modal_fail">
      <div class="modal-box3">
          <img class="imgWagi">
          <div class="modal-content3">
              <h2 class="message"><p id="f_stdId" style="display:inline;"></p>&nbsp;<p id="f_stdName" style="display:inline;"></p>님</h2>
              <div class="failure_message">
                      <h4 style="margin-top: 20px;">
                          WAGI 신입부원 모집에
                          <br>
                          안타깝게 불합격 하셨습니다.
                          <br>
                          당신의 미래를 응원합니다.
                      </h4>
              </div>
          </div>
      </div>
  </div>

  <script>
    // 메일 입력
    $(document).ready(function () {
        $("#apply").click(function (e) { //join버튼 누름
            e.preventDefault();
            if ({{ isDate }} === 0) {
            $(".modal_unavailable").show();

           var userEmail = $("#input_email").val();
           $.ajax({
               url: '{% url "joinResult:join_button" %}', 
               method: 'POST',
               data: {
                'user_mail': userEmail,
                'csrfmiddlewaretoken': '{{ csrf_token }}' 
                },
               success: function (response) {
                 console.log(response);
                },
               error: function (error) {
                console.error(error);
                }
            });    
            // 모달 닫기 버튼 
           const closeModal = document.querySelector('#close-modal');
           closeModal.addEventListener("click", ()=>{
            $(".modal_unavailable").hide();
            input.value=null;
           });    
            
        }
        });
    });
            
    $( document ).ready( function() {
            $( '#email' ).on("submit", function(event) {
                $( '.modal-content1' ).animate({ 
                    height: 0, 
                    opacity: 0 
                }, 700 , event.preventDefault());
                $('.up').text( 
                    "해당 주소로 메일을 보내드리겠습니다."); 
                $('.up').css({'background':'white'}); 
            } );
        } );

      // 합불여부
      $(document).ready(function () {
         $("#btn_studentNum").click(function (e) {
            e.preventDefault();
             checkResult();
         });

         function checkResult() {
             const inputId = $("#input_studentNum").val();
             $.ajax({
                 url:"{% url 'joinResult:result' %}",
                 method: "POST",
                 headers: {
                     'Content-Type': 'application/x-www-form-urlencoded',
                     'X-CSRFToken': '{{ csrf_token }}'
                 },
                 data: { 'inputId': inputId },
                 dataType: "json",
                 success: function (data) {
                     $(".modal_pass, .modal_fail").hide();
                     if (data.result === 'pass') {
                         $("#p_stdId").text(data.number);
                         $("#p_stdName").text(data.name);
                         $(".modal_pass").show();
                     } else if (data.result === 'fail') {
                         $("#f_stdId").text(data.number);
                         $("#f_stdName").text(data.name);
                         $(".modal_fail").show();
                     }
                 },
                 error: function (error) {
                     console.error('Error:', error);
                 }
             });
         }

     });


  </script>
 </body>
</html>